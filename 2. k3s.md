## k3s

이제 남은 건 VM 3대(cp1/w1/w2)에 Host-Only(어댑터2) 붙이고, Ubuntu에서 192.168.56.10/11/12 고정 IP를 잡은 뒤 K3s 멀티노드 설치하면 끝입니다.

1) VirtualBox에서 VM 네트워크 설정 (3대 모두)

각 VM 선택 → 설정(Settings) → 네트워크(Network)

어댑터 1: NAT

어댑터 2: 사용(Enable) 체크

연결 방식: Host-only Adapter

이름: VirtualBox Host-Only Ethernet Adapter

✅ 케이블 연결됨(Cable connected)

이 설정을 해야 VM끼리 + Windows와 192.168.56.x로 통신됩니다.

2) Ubuntu 22.04에서 Host-Only 고정 IP 설정 (각 VM)

각 VM에서 먼저 인터페이스 이름 확인:

ip -br a


보통

NAT: enp0s3

Host-Only: enp0s8

cp1: 192.168.56.10
sudo tee /etc/netplan/00-installer-config.yaml >/dev/null <<'EOF'
network:
  version: 2
  ethernets:
    enp0s3:
      dhcp4: true
    enp0s8:
      dhcp4: no
      addresses: [192.168.56.10/24]
EOF
sudo netplan apply
ip -br a

w1: 192.168.56.11 / w2: 192.168.56.12

주소만 각각 바꿔서 동일하게 적용하세요.

3) 통신 테스트 (여기서 성공해야 다음으로 진행)
Windows → cp1

PowerShell:

ping 192.168.56.10

cp1 → Windows Host-Only

cp1에서:

ping -c 1 192.168.56.1


✅ 둘 다 되면 네트워크 완료.

4) K3s 멀티노드 설치 (Docker 없이)
4-1) hostname 유니크 (각 VM에서 1회)
sudo hostnamectl set-hostname cp1   # cp1
sudo hostnamectl set-hostname w1    # w1
sudo hostnamectl set-hostname w2    # w2

4-2) cp1에 서버 설치

cp1에서:

sudo apt update && sudo apt install -y curl

curl -sfL https://get.k3s.io | \
  K3S_KUBECONFIG_MODE="644" sh -s - \
  --node-ip 192.168.56.10 \
  --flannel-iface enp0s8


토큰 확인:

sudo cat /var/lib/rancher/k3s/server/node-token

4-3) w1/w2 워커 조인 (WSL 말고 “VM 콘솔”에서!)

w1에서:

sudo apt update && sudo apt install -y curl

curl -sfL https://get.k3s.io | \
  K3S_URL="https://192.168.56.10:6443" \
  K3S_TOKEN="(cp1에서 복사한 토큰)" sh -s - \
  --node-ip 192.168.56.11 \
  --flannel-iface enp0s8


w2에서(주소만 변경):

sudo apt update && sudo apt install -y curl

curl -sfL https://get.k3s.io | \
  K3S_URL="https://192.168.56.10:6443" \
  K3S_TOKEN="(토큰)" sh -s - \
  --node-ip 192.168.56.12 \
  --flannel-iface enp0s8

4-4) cp1에서 최종 확인
kubectl get nodes -o wide
kubectl get pods -A


cp1, w1, w2가 Ready면 성공.

중요 정리

WSL은 워커로 조인하지 마세요. (WSL ↔ Host-Only 네트워크가 기본으로 직접 통신 안 되는 경우가 많아서 이미 한 번 막혔죠.)

WSL은 필요하면 나중에 kubectl 관리용으로만 붙이면 됩니다.

지금 다음 액션

cp1 VM에 어댑터2 붙인 뒤, cp1에서 ip -br a 출력 한 줄만 보내주세요.

그리고 Windows에서 ping 192.168.56.10 결과도 알려주세요.

그 두 개가 OK면, 제가 당신 환경 기준으로 **정확한 인터페이스 이름(enp0s8 맞는지)**까지 포함해서 “완전 복붙” 최종 커맨드로 마무리해드릴게요.


---
![alt text](image.png)

https://releases.ubuntu.com/jammy/
![alt text](image-1.png)

![alt text](image-2.png) 


root@DESKTOP-D6A344Q:/mnt/c/Users/LG# curl -sfL https://get.k3s.io | sh -
sudo systemctl status k3s

root@DESKTOP-D6A344Q:/mnt/c/Users/LG# vi /etc/rancher/k3s/k3s.yaml

root@DESKTOP-D6A344Q:/mnt/c/Users/LG# sudo cat /var/lib/rancher/k3s/server/node-token
K10c41db8ef6e897dd980e6aeb09f6be57b65d38e4bb84c9e8e89b64aa555af4db6::server:aad47024f2fb3a0d24423334a72a586c


root@DESKTOP-D6A344Q:/mnt/c/Users/LG# apt install net-tools

root@DESKTOP-D6A344Q:/mnt/c/Users/LG# ip -br a
lo               UNKNOWN        127.0.0.1/8 10.255.255.254/32 ::1/128
eth0             UP             172.22.95.21/20 fe80::215:5dff:feba:bf00/64
flannel.1        UNKNOWN        10.42.0.0/32 fe80::3424:8dff:fec2:bc2f/64
cni0             UP             10.42.0.1/24 fe80::8472:2ff:fee4:2463/64
veth001af001@if2 UP             fe80::94d1:f9ff:fe59:8d14/64
vethf14fc0e6@if2 UP             fe80::4496:42ff:fed6:7fd2/64
veth8b3fc7b6@if2 UP             fe80::68de:20ff:fe25:4d2c/64
veth7e0e71b8@if2 UP             fe80::e475:c9ff:fee6:48db/64
vetha16d619d@if2 UP             fe80::18d4:b2ff:fe1b:4247/64


sudo apt update
sudo apt install -y iptables iptables-persistent conntrack socat ebtables ethtool


command -v iptables-save
command -v iptables-restore


sudo update-alternatives --set iptables /usr/sbin/iptables-legacy
sudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy


curl -sfL https://get.k3s.io | K3S_URL=https://192.168.56.10:6443 K3S_TOKEN=K10c41db8ef6e897dd980e6aeb09f6be57b65d38e4bb84c9e8e89b64aa555af4db6::server:aad47024f2fb3a0d24423334a72a586c sh -

curl -sfL https://get.k3s.io | \
  K3S_URL="https://192.168.56.10:6443" \
  K3S_TOKEN="K10c41db8ef6e897dd980e6aeb09f6be57b65d38e4bb84c9e8e89b64aa555af4db6::server:aad47024f2fb3a0d24423334a72a586c" \
  sh -s - --node-ip 192.168.56.11 --flannel-iface enp0s8
